<html>
<?php include 'menue/header.php';?>
<body>
<?php include 'menue/navbar.php';?>
<h1>Scenario 12</h1>
<p>In this scenario the uploaded file is simulated to be analyzed and consecutively removed if it is detected to be malicious.</p>
<br>
<br>
<div class="upload-form">
    <h2>Upload an Image!</h2>
    <form action="" method="POST" enctype="multipart/form-data">
      <label for="fileToUpload">Select a file:</label>
      <input type="file" name="fileToUpload" id="fileToUpload">
      <input type="submit" value="Upload" name="submit">
    </form>
</div>

<?php
$file = isset($_FILES["fileToUpload"]) ? $_FILES['fileToUpload'] : NULL;

if(isset($file) && $file["name"] != ""){
    $file_path = "uploads/" . $file["name"];

    //temporary move
    move_uploaded_file($file["tmp_name"],$file_path);
    if(checkViruses($file_path) && checkFileType($file_path)){
        echo "<a href='". htmlentities($file_path) ."'>See the image!</a>";
    } else{
        unlink($file_path);
        echo "Sorry, there was an error while uploading! <br>";
        http_response_code(403);
    }
    
}

function checkViruses($fileName){
    usleep(500000);
    return true;
}

function checkFileType($fileName){
    $extension = strtolower(pathinfo($fileName, PATHINFO_EXTENSION));
    if($extension != "jpg" && $extension !="png"){
        echo "Sorry, only JPG & PNG file are allowed <br>";
        return false;
    }else{
       return true; 
    }
}
?>

<?php include 'menue/footer.php'; ?>
</body>
</html>