<html>
<?php include 'menue/header.php';?>
<body>
<?php include 'menue/navbar.php';?>
<h1>Scenario 4</h1>
<p>This scenario tries to block the upload of .php files and only accepts .png and .jpeg.</p>
<br>
<br>
<?php error_reporting(0); ?>
<div class="upload-form">
    <h2>Upload an Image!</h2>
    <form action="" method="POST" enctype="multipart/form-data">
      <label for="fileToUpload">Select a file:</label>
      <input type="file" name="fileToUpload" id="fileToUpload">
      <input type="submit" value="Upload" name="submit">
    </form>
</div>

<?php
$file = isset($_FILES["fileToUpload"]) ? $_FILES['fileToUpload'] : NULL;

if(isset($file) && $file["name"] != ""){
  $info = new SplFileInfo($file["name"]);
  $extension = strtolower($info->getExtension());
  $file_path = "uploads/" . $file["name"];
  if($extention == "php"){
    echo "Sorry, can't accept php file!\n";
    $success = false;
  } else {
    $success = true;
  }
  if($success && $extension == "php5" && move_uploaded_file($file["tmp_name"],$file_path)){
    echo "Servers may execute alternative php extensions as well.";
    echo "<br>";
    echo "<a href='$file_path'>See the image!</a>";
  }
  if($success && ($extension == "png" || $extension == "jpeg") && move_uploaded_file($file["tmp_name"],$file_path)){
    echo "<a href='$file_path'>See the image!</a>";
  }
}
?>

<?php include 'menue/footer.php'; ?>
</body>
</html>
